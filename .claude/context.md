# プロジェクト背景と制約

## プロジェクト背景

### PyQC開発の目的
- Claude Codeの実践的アプローチのデモンストレーション
- 「堅牢なコードを書く」を具体的に支援するツールの実装
- Python品質チェックツールの統合環境提供

### プレゼンテーション文脈
- みんなのPython勉強会#116での発表素材
- 3つのポイント（計画・記録・堅牢性）の実践例
- Vibe Coding → Agentic Codingへの移行デモ

## 技術的制約

### Python環境
- **バージョン**: Python 3.12以上
- **パッケージ管理**: uv必須
- **仮想環境**: uvによる自動管理

### 依存関係制約
- **外部ツール**: ruff, mypy
- **CLI**: typer（Rich統合）
- **設定**: Pydantic v2（エイリアス対応）
- **テスト**: pytest + pytest-cov
- **TOML**: tomllib（読み込み）+ tomli-w（書き込み）
- **YAML**: PyYAML

### パフォーマンス制約
- **実行時間**: 中規模プロジェクト10秒以内
- **メモリ**: 大規模プロジェクト500MB以下
- **並列実行**: CPUコア数ベース

## 開発制約

### スコープ制約
- **MVP範囲厳守**: Phase 1は品質チェックのみ
- **機能追加禁止**: 計画外の拡張は次フェーズ
- **デモ優先**: プレゼンテーション用の動作確認重視

### 品質制約
- **TDD実践**: テストファースト開発
- **カバレッジ**: 80%以上
- **自己品質**: PyQC自身でチェック通過

### 時間制約
- **Phase 1**: 40-60時間（1-2週間）
- **デモ準備**: プレゼンテーション日程考慮
- **学習コスト**: 30分以内で基本操作習得

## ビジネス制約

### ライセンス
- **MIT License**: オープンソース
- **商用利用**: 制限なし
- **依存関係**: MIT互換ライセンスのみ

### 配布方法
- **PyPI**: uv publishによる公開
- **GitHub**: ソースコード公開
- **ドキュメント**: README中心

## 運用制約

### 互換性
- **既存ツール**: ruff/mypy設定互換
- **エディタ**: VSCode, PyCharm対応
- **CI/CD**: GitHub Actions統合

### メンテナンス
- **更新頻度**: 依存関係の追従
- **サポート**: コミュニティベース
- **Breaking Changes**: セマンティックバージョニング

## リスク要因

### 技術リスク
- **ruff API変更**: 頻繁なアップデート
- **mypy/ty競合**: 型チェッカー選択の複雑性
- **uvエコシステム**: 新しいツールの成熟度
- **設定複雑性**: TOML/YAML/エイリアス変換の複雑性
- **外部プロセス実行**: subprocess実行の安全性とエラーハンドリング
- **出力パーサー**: ツールバージョンによる出力形式変更

### プロジェクトリスク
- **スコープクリープ**: 機能追加の誘惑
- **品質vs速度**: 完璧主義の罠
- **学習コスト**: 新技術習得の時間

### 外部リスク
- **依存関係**: セキュリティ脆弱性
- **Python変更**: 言語仕様変更
- **競合ツール**: 既存ツールの機能向上

## Claude Code Hooks 統合（最終形態）

### 設計背景
- **${file}変数問題の解決**: 従来のhooks設定での変数展開問題
- **統合ワークフロー**: ファイル編集とGit操作の自動品質保証
- **AI開発最適化**: 高頻度操作に対応した非ブロッキング設計

### 最終アーキテクチャ
- **PostToolUse**: `claude_hooks.py`（JSON入力、ファイル編集時）
- **PreToolUse**: `git_hooks_detector.py`（Git操作検知、pre-commit品質チェック）
- **責任分離**: 編集時即時チェック vs コミット時包括的検証

### 技術的突破
- **JSON stdin処理**: Claude Code hooks標準仕様への完全準拠
- **フルパス設定**: 実行環境の安定性確保
- **並列品質チェック**: PyQC + pytest同時実行による高速化

### 運用実績
- **PostToolUse**: < 3秒（ファイル編集時）
- **PreToolUse**: 20秒（Git pre-commit、並列実行）
- **品質達成**: Total issues 0、100%品質通過

### AI開発特化機能
- **高頻度コミット対応**: 連続操作への適応
- **非Gitコマンドスキップ**: 適切な処理分岐
- **包括的ログ記録**: `.pyqc/hooks.log`、`.pyqc/git_hooks.log`